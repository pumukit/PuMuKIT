{% include "@PumukitCore/Upload/common.js.twig" %}

var endpoint = "{{ inboxUploadURL }}" + "?folder_path={{ form_data }}";

{% if form_data is same as("") %}
    endpoint = "{{ inboxUploadURL }}";
{% endif %}

const uppyTUS = Uppy.Core({
    debug: false,
    autoProceed: true,
    restrictions: {
        minFileSize: convertSizeToBytes("{{ minFileSize }}"),
        maxFileSize: convertSizeToBytes("{{ maxFileSize }}"),
        maxNumberOfFiles: {{ maxNumberOfFiles }},
        allowedFileTypes: ['audio/*','video/*']
    },
    onBeforeFileAdded:  (currentFile) => {
            var fileName = currentFile.name;
            fileName = fileName.replace(/[\W_]+/g,"_");
            currentFile.name = `${Date.now()}_${fileName}`;
        }
    })
    .use(Uppy.Dashboard, {
        target: '#uploader_drag_and_drop',
        inline: true
    })
    .use(Uppy.Tus, {
        endpoint: endpoint,
        limit: {{ inboxUploadLIMIT }}
    })
    .run()

{% include "@PumukitCore/Upload/uppy_dispatch.js.twig" %}
