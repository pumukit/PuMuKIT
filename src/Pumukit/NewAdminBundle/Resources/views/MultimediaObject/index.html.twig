{% extends 'PumukitNewAdminBundle::layout.html.twig' %}

{% block body %}
<h3 class="cab_body_div">
  <a title="{% trans %}Back to series list{% endtrans %}" href="{{ path('pumukitnewadmin_series_index') }}" class="btn btn-pumukit btn-raised pull-right">
    {% trans %}Â« Back to series{% endtrans %}
  </a>
  <ul class="breadcrumb" style="margin-bottom: 5px;">
    <li><a href="{{ path('pumukitnewadmin_series_index') }}">Series{% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %} ({{ series.getTitle() }}){% endif %}</a></li>
    {% if app.user and is_granted('ROLE_SCOPE_PERSONAL') %}
      <li class="active">{% trans %}My Multimedia Objects{% endtrans %}</li>
    {% else %}
      <li class="active">{% trans %}Multimedia Objects{% endtrans %}</li>
    {% endif %}
  </ul>
  {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %}
  <input type="hidden" name="series_id" id="mms_series_id" value="{{ series.id }}" />
  {% endif %}
</h3>

<div class="row">
  {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %}
  <div id="tv_admin_content" class="col-md-10">
    <div class="well">
      <div id="list_mms">
        {% include 'PumukitNewAdminBundle:MultimediaObject:list.html.twig' %}
      </div>
      <div class="row">
        <div class="col-xs-4">
          <select id="options_mms" class="form-control" title="{% trans %}Actions on selected items{% endtrans %}" onchange="window.change_select('mm', $(this), 'mms', '{{series.id}}');">
            <option value="default" selected="selected">{% trans %}Select an action{% endtrans %}...</option>
            <option disabled="">---</option>
            <option value="delete_selected">{% trans %}Delete selected{% endtrans %}</option>
            <option value="invert_announce_selected">{% trans %}Announce/Not announce selected{% endtrans %}</option>
            <option disabled="">---</option>
            <option value="order_pub_date_desc">{% trans %}List multimedia objects in descending order of publication date{% endtrans %}</option>
            <option value="order_pub_date_asc">{% trans %}List multimedia objects in ascending order of publication date{% endtrans %}</option>
            <option value="order_rec_date_desc">{% trans %}List multimedia objects in descending order of recording date{% endtrans %}</option>
            <option value="order_rec_date_asc">{% trans %}List multimedia objects in ascending order of recording date{% endtrans %}</option>
            <option disabled="">---</option>
            <option value="cut_mm">{% trans %}Cut multimedia objects{% endtrans %}</option>
            {% if app.session.has('admin/mms/cut') and app.session.get('admin/mms/cut')%}
            <option value="paste_mm" id="paste_mm">
              {% trans %}Paste multimedia objects{% endtrans %} ({% for id in app.session.get('admin/mms/cut') %}{{ id }}{% if not loop.last %},&nbsp;{% endif %}{% endfor %})
            </option>
            {% else %}
            <option value="paste_mm" id="paste_mm" style="display:none"></option>
            {% endif %}
            <option value="add_playlist">{% trans %}Add to playlist{% endtrans %}</option>
            <option disabled="">---</option>
            <option value="series_preview" id="{{ series.secret }}">{% trans %}Preview show of the series{% endtrans %}</option>
          </select>
        </div>
        <div class="col-xs-8 text-right">
          {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_WIZARD_UPLOAD')) %}
          <a class="btn btn-primary btn-raised" href="{{ url('pumukitwizard_default_type', {'id': series.id}) }}">{% trans %}Wizard{% endtrans %}</a>
          {# TODO mmwizard and path with series id (add title to pumukitwizard default type)
          <a class="btn btn-primary btn-raised" href="#" onclick="Modalbox.show('/editar.php/mmwizard/index/mod/mms/serial_id/782',{width: 800, title:'{% trans %}STEP II: MM.OBJ.{% endtrans %}'}); return false;">Wizard</a> #}
          {% endif %}
          {# TODO Path create with page number #}
          {% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_ADVANCED_UPLOAD')) %}
          <a title="{% trans %}Create new multimedia object{% endtrans %}" id="pumukitnewadmin_mms_new_button" class="btn btn-pumukit btn-raised" href="#">{% trans %}New{% endtrans %}</a>
          {% endif %}
        </div>
      </div>
    </div>
    <div id="edit_mm">
      {% if(app.session.has('admin/series/id') and app.session.has('admin/mms/id')) %}
      {{ render(url('pumukitnewadmin_mms_edit', {'id': app.session.get('admin/mms/id'), 'seriesId': app.session.get('admin/series/id')})) }}
      {% endif %}
    </div>
  </div>

  <div id="tv_admin_bar" class="col-md-2 hidden-xs hidden-sm">
    <div id="preview_mm" class="well">
      {% if(app.session.has('admin/mms/id')) %}
      {{ render_hinclude(url('pumukitnewadmin_mms_show', {'id': app.session.get('admin/mms/id')})) }}
      {% else %}
      {% trans %}Select any multimedia object.{% endtrans %}
      {% endif %}
    </div>
  </div>
  {% else %}
  <div class="col-md-12">
    <div class="well">
      {% trans %}You don't have enough permissions to access this content.{% endtrans %}
    </div>
  </div>
  {% endif %}
</div>

<div class="modal fade" id="myAuxModal" tabindex="-1" role="dialog" aria-labelledby="myAuxModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    </div>
  </div>
</div>

{% if app.user and is_granted(constant('Pumukit\\SchemaBundle\\Security\\Permission::ACCESS_MULTIMEDIA_SERIES')) %}
<script type="text/javascript">
/* TODO
var update_file;
window.onload = function(){
  Shadowbox.init({
    skipSetup:  true,
    onOpen:     function(element) {
                  if (typeof update_file == 'object') update_file.stop();
                },
    onClose:    function(element) {
                  if (typeof update_file == 'object') update_file.start();
                }
  });
};
*/

window.update_preview_mms = function(id) {
  var route = "{{ path('pumukitnewadmin_mms_show', {id: '__id__'}) }}";
  $.ajax({
          url: route.replace('__id__', id),
          type: 'POST',
          success: function(response){$('#preview').html(response);}
         });
}

</script>
{% endif %}
{% endblock %}
