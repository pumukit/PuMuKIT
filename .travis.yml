sudo: false

services:
  - docker

language: php

before_script:
  - docker-compose build --build-arg APP_ENV=dev
  - docker-compose up -d
  - docker-compose exec php bin/console doctrine:mongodb:schema:create
  - docker-compose exec php bin/console pumukit:init:repo all --force

script:
  - docker-compose exec php composer ci
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy/series/channel/1.html
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy/latestuploads
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy/searchmultimediaobjects
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy/searchseries
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy/mediateca
  - docker-compose -f docker-compose.yml -f docker-compose.test.yml run pa11y https://h2-proxy/categories